<!DOCTYPE html>
<html>
<head>
    <title>Admin - Frequency Editor</title>
    <style>
        textarea { width: 100%; height: 300px; font-family: monospace; }
        button { margin-top: 10px; padding: 8px 15px; }
    </style>
</head>
<body>
    <h1>Frequency Editor</h1>
    <textarea id="jsonEditor"></textarea><br>
    <button id="saveButton">Save Changes</button>
    <p id="status"></p>

    <script>
        // Load current data
        fetch('data/frequencies.json')
            .then(response => response.text())
            .then(data => {
                document.getElementById('jsonEditor').value = data;
            });

        // Save function (uses GitHub API)
        document.getElementById('saveButton').addEventListener('click', () => {
            const newData = document.getElementById('jsonEditor').value;
            try {
                JSON.parse(newData); // Validate JSON
                updateGitHubFile(newData);
            } catch (e) {
                document.getElementById('status').textContent = 'Error: Invalid JSON!';
            }
        });

        // GitHub API function
        async function updateGitHubFile(newContent) {
            const repo = 'YOUR_GITHUB_USERNAME/YOUR_REPO_NAME'; // ← Edit this
            const filePath = 'data/frequencies.json';
            const token = 'YOUR_GITHUB_TOKEN'; // ← Create at: https://github.com/settings/tokens (select "repo" scope)

            // Get latest SHA (required by GitHub API)
            const shaResponse = await fetch(`https://api.github.com/repos/${repo}/contents/${filePath}`, {
                headers: { 'Authorization': `token ${token}` }
            });
            const shaData = await shaResponse.json();

            // Update file
            const response = await fetch(`https://api.github.com/repos/${repo}/contents/${filePath}`, {
                method: 'PUT',
                headers: { 'Authorization': `token ${token}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    message: 'Update frequencies.json via admin panel',
                    content: btoa(unescape(encodeURIComponent(newContent))),
                    sha: shaData.sha
                })
            });

            if (response.ok) {
                document.getElementById('status').textContent = 'Successfully updated!';
            } else {
                document.getElementById('status').textContent = 'Error saving. Check console.';
                console.error(await response.json());
            }
        }
    </script>
</body>
</html>